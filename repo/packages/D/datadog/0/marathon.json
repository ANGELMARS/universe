{
    "id": "datadog-agent",
    "container": {
        "type": "DOCKER",
        "docker": {
            "image": "alq666/docker-dd-agent:mesos",
            "parameters": [
                {
                    "key": "name", "value": "dd-agent"
                },
                {
                    "key": "env", "value": "API_KEY={{datadog.api_key}}"
                }
            ],
            "network": "BRIDGE",
            "portMappings": [
                { "hostPort": 8125, "containerPort": 8125, "protocol": "udp" },
                { "hostPort": 9001, "containerPort": 9001, "protocol": "tcp" }
            ]
        },
        "volumes": [
            {
                "containerPath": "/var/run/docker.sock",
                "hostPath": "/var/run/docker.sock",
                "mode": "RW"
            },
            {
                "containerPath": "/host/proc/mounts",
                "hostPath": "/proc/mounts",
                "mode": "RO"
            },
            {
                "containerPath": "/host/sys/fs/cgroup",
                "hostPath": "/sys/fs/cgroup",
                "mode": "RO"
            }
        ]
    },
    "cpus": {{datadog.cpus}},
    "mem": {{datadog.mem}},
    "instances": {{datadog.instances}},
    "acceptedResourceRoles": ["slave_public"],
    "constraints": [
        ["hostname", "UNIQUE"],
	["hostname", "GROUP_BY"]
    ],
    "healthChecks": [
        {
            "path": "/",
            "portIndex": 1,
            "protocol": "HTTP",
            "gracePeriodSeconds": 300,
            "intervalSeconds": 60,
            "timeoutSeconds": 20,
            "maxConsecutiveFailures": 3,
            "ignoreHttp1xx": false
        }
    ]
}
